充值合约部署在以太坊主链上。
乐块合约部署在loom侧链上，主要因为充值的场景少，可以慢一点，乐块的操作场景多，要快。

充值合约：
1、用户用TAT充值
这一步用户只调用了TAT合约里的函数，没有调用充值合约里的函数，但是用户会把TAT打到充值合约的地址上，所以这一步只需要在充值合约里面实现一个能够提取TAT的函数即可。
具体过程
用户调用了TAT合约里面的转移TAT的函数transfer()，发出Event，但是充值合约是读不到的(loom的网关gateway还没放出来，而且本身以太坊上的合约也读不到Event)，所以需要我们服务器上有程序去读取Event，然后再筛选出_to地址是我们充值合约的地址，得到哪个地址（玩家）充值了。然后在我们服务器上根据玩家以太坊地址查询loom侧链地址（简单起见，假设一一对应），我们在loom侧链上给对应的玩家转移对应的“TAT”给玩家。暂时就是在乐块合约里面定义了一个状态变量保存充进来的“TAT”数值，也就是说侧链里面“TAT”没有实现ERC20标准。

2、用户用ETH充值
给用户一个ETH购买TAT的比较方便的途径，要求先给这充值合约地址充值一定数量的TAT。
只实现充值ETH买TAT，没有实现充值TAT提取ETH。一是用户充值TAT到充值合约地址，他调用的是TAT合约的transfer，充值合约不知道这个消息，要实现需要像上面一样搞个程序去监听TAT合约，执行充值合约里面的函数。(有个方法是用户先调TAT合约的approve函数，再掉调用充值合约里面的函数把TAT转过来，这个倒不是很麻烦，只是要求用户操作两部分)。二是如果功能上实现了充值提现，就类似一个交易所了，TAT已经上线了交易所，价格是波动的，所以需要随时设置充值合约里面的price(充值合约里面有这个功能，但是需要外部脚本不断查询TAT价格且不断调用那个设置函数)

乐块合约：
1、算力变化
算力是个状态变量, 所以只有当设置算力的那个函数被调用的时候才能让算力变化。如果要求用户每隔一小时调用一下函数？好像不是很科学。加密猫的拍卖也是一个变化的，但是他们没有把猫的价格设定为状态变量，而是根据拍卖过去的时间以及初末价格，拍卖持续总时间算出来的。只要打入的eth金额大于等于这个价格就可以交易成功。这个我到时再看看。

2、用户注册，有多少用户这个放在中心服务器上吧，因为这个如果放在合约里面，别人可以不通过我们app的注册途径而是直接调用合约上的相关函数。

乐块ERC20合约：
有个疑惑：
基础乐块的ERC20合约有两个实现方式：
1. 在一个合约里面通过定义数组来保存不同类型的乐块。同样支持ERC20的各种函数名字。弊端：整个实现是像ERC20，但不是真正的ERC20，比如查询余额，真正的ERC20只需要传入一个地址参数（因为合约里只有一个20token），但是我们这样实现就需要一个地址参数和一个乐块类型参数（这个地址下哪种乐块的余额数）。支不支持标准ERC20会影响交易所（主要是去中心化交易所，中心化交易所不清楚），所以就看这些乐块以后要不要上交易所。
2. 发行多个ERC20合约，每新加一个乐块类型发一份，然后通过接口实现合约之间的相互通信。这个好像没什么弊端。
暂时用 2